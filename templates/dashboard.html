<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial;
            background: #f4f6f8;
        }

        .navbar {
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            font-weight: bold;
        }

        .container {
            padding: 30px;
        }

        .welcome {
            text-align: center;
            margin-bottom: 20px;
        }

        .cards {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
        }

        .card h3 {
            margin-bottom: 10px;
            color: #555;
        }

        .card p {
            font-size: 28px;
            font-weight: bold;
            color: #27ae60;
        }

        .music-card, .action-card, .chart-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .music-card audio {
            width: 100%;
            margin: 10px 0;
        }

        button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .action-btn {
            padding: 12px 20px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            background: #2c3e50;
            color: white;
        }

        .stopwatch-card {
            width: 350px;
            margin: auto;
            padding: 20px;
            text-align: center;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .timer {
            font-size: 40px;
            font-weight: bold;
            margin: 20px 0;
            color: #333;
        }

        .btn-group button {
            padding: 10px 18px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            color: white;
        }

        .btn-group button:nth-child(1) { background: #4CAF50; }
        .btn-group button:nth-child(2) { background: #f39c12; }
        .btn-group button:nth-child(3) { background: #e74c3c; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 10px;
            margin-top: 10px;
        }

        .progress-fill {
            height: 10px;
            background: #27ae60;
            border-radius: 10px;
        }
    </style>
</head>
<body>

<div class="navbar">
    <h2>üèãÔ∏è GymTune</h2>
    <div>
        <a href="/dashboard">Home</a>
        <a href="/history">History</a>
        <a href="/download">Download</a>
        <a href="/logout">Logout</a>
    </div>
</div>

<div class="container">
    <h1 class="welcome">Welcome to GymTune</h1>
    {% if message %}
    <p style="color:green; text-align:center; font-weight:bold;">{{ message }}</p>
    {% endif %}

    <p style="text-align:center;">
        üí™ Stay consistent. Small workouts every day create big results!
    </p>

    <div class="card" style="margin-bottom: 30px;">
        <h2>üìä Fitness Analytics & Trends</h2>
        <div class="cards" style="flex-wrap: wrap;">
            <div class="card" style="min-width: 150px; border-left: 5px solid #27ae60;">
                <h3>Consistency</h3>
                <p>{{ consistency }}%</p>
                <small>Last 30 Days</small>
            </div>
            <div class="card" style="min-width: 150px; border-left: 5px solid #e67e22;">
                <h3>Streak</h3>
                <p>üî• {{ streak }}</p>
                <small>Days Active</small>
            </div>
            <div class="card" style="min-width: 150px; border-left: 5px solid #c0392b;">
                <h3>Quit Risk</h3>
                <p style="color: {% if risk == 'HIGH' %}#c0392b{% elif risk == 'MEDIUM' %}#e67e22{% else %}#27ae60{% endif %};">
                    {{ risk }}
                </p>
                <small>Based on Recency</small>
            </div>
        </div>

        <div class="cards" style="margin-top: 10px; font-size: 0.9em;">
            <div class="card">
                <h4>Workouts</h4>
                <p style="font-size: 20px;">Total: {{ workouts }}</p>
                <p style="font-size: 20px;">Weekly: {{ weekly_count }}/{{ weekly_goal }}</p>
            </div>
            <div class="card">
                <h4>Calories</h4>
                <p style="font-size: 20px;">Total: {{ calories }}</p>
                <p style="font-size: 20px;">Monthly: {{ monthly_calories }}</p>
            </div>
            <div class="card">
                <h4>Duration</h4>
                <p style="font-size: 20px;">Avg: {{ avg_duration }}m</p>
                <p style="font-size: 20px;">Max: {{ longest_workout }}m</p>
            </div>
        </div>

        <hr>
        <h3>Activity Insights (Time vs. Intensity)</h3>
        <div style="height: 300px;">
            <canvas id="fitnessTrendChart"></canvas>
        </div>
    </div>

    <div class="music-card">
        <h2>üéß Workout Playlist</h2>
        <audio id="player" controls autoplay src="/static/music/song1.mp3"></audio>
        <br><br>
        <button onclick="prevSong()">‚èÆ Previous</button>
        <button onclick="pauseSong()">‚èØ Pause / Play</button>
        <button onclick="nextSong()">‚è≠ Next</button>
        <p>Workout playlist playing continuously üí™</p>
    </div>

    <div class="action-card">
        <h2>üöÄ Quick Actions</h2>
        <p>Track today's workout and stay consistent.</p>
        <a href="/start_workout"><button class="action-btn">Start Workout ‚ñ∂Ô∏è</button></a>
        <a href="/stop_workout"><button class="action-btn">Stop Workout ‚èπÔ∏è</button></a>
        <a href="/history"><button class="action-btn">View History üìä</button></a>
        <a href="/download"><button class="action-btn">Download Report üì•</button></a>
    </div>

    <div class="stopwatch-card">
        <h2>‚è± Workout Stopwatch</h2>
        <div id="time" class="timer">00:00:00:00</div>
        <div class="btn-group">
            <button onclick="startTimer()">Start</button>
            <button onclick="pauseTimer()">Pause</button>
            <button onclick="resetTimer()">Reset</button>
        </div>
    </div>

    <br>

    {% if risk == "HIGH" %}
    <p style="color:red; text-align:center;">‚ö† You haven‚Äôt worked out recently. Let‚Äôs restart today!</p>
    {% elif risk == "MEDIUM" %}
    <p style="color:orange; text-align:center;">‚è≥ You‚Äôre slowing down. Schedule your next workout!</p>
    {% else %}
    <p style="color:green; text-align:center;">üî• Great consistency! Keep pushing!</p>
    {% endif %}

</div>

<script>
// TREND CHART SCRIPT
const labels = {{ dates | tojson | safe }};
const dataCounts = {{ counts | tojson | safe }}; 
const ctxTrend = document.getElementById('fitnessTrendChart');

new Chart(ctxTrend, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Workout Frequency',
            data: dataCounts,
            borderColor: '#27ae60',
            backgroundColor: 'rgba(39, 174, 96, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 3,
            pointRadius: 5
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' },
            tooltip: { mode: 'index', intersect: false }
        },
        scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Number of Workouts' } },
            x: { title: { display: true, text: 'Date' } }
        }
    }
});

// STOPWATCH SCRIPT
let milliseconds = 0, seconds = 0, minutes = 0, hours = 0, timer = null;

function updateDisplay() {
    let h = String(hours).padStart(2, '0');
    let m = String(minutes).padStart(2, '0');
    let s = String(seconds).padStart(2, '0');
    let ms = String(milliseconds).padStart(2, '0');
    document.getElementById("time").innerText = `${h}:${m}:${s}:${ms}`;
}

function startTimer() {
    if (!timer) {
        timer = setInterval(() => {
            milliseconds += 1;
            if (milliseconds == 100) { milliseconds = 0; seconds++; }
            if (seconds == 60) { seconds = 0; minutes++; }
            if (minutes == 60) { minutes = 0; hours++; }
            updateDisplay();
        }, 10);
    }
}

function pauseTimer() { clearInterval(timer); timer = null; }

function resetTimer() {
    pauseTimer();
    milliseconds = seconds = minutes = hours = 0;
    updateDisplay();
}

// MUSIC SCRIPT
let songs = [
    "/static/music/song1.mp3", "/static/music/song2.mp3", "/static/music/song3.mp3",
    "/static/music/song4.mp3", "/static/music/song5.mp3", "/static/music/song6.mp3",
    "/static/music/song7.mp3", "/static/music/song8.mp3", "/static/music/song9.mp3",
    "/static/music/song10.mp3"
];
let currentSong = 0;
let player = document.getElementById("player");

player.addEventListener("ended", nextSong);

function nextSong() {
    currentSong = (currentSong + 1) % songs.length;
    player.src = songs[currentSong];
    player.play();
}

function prevSong() {
    currentSong = (currentSong - 1 + songs.length) % songs.length;
    player.src = songs[currentSong];
    player.play();
}

function pauseSong() {
    player.paused ? player.play() : player.pause();
}
</script>

</body>
</html>